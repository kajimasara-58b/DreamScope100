<!DOCTYPE html>
<html>
<head>
  <!-- Turboのキャッシュを無効化 -->
  <meta name="turbo-cache-control" content="no-cache">
</head>

<%= render "shared/header" %>

<%= render 'devise/shared/error_messages', resource: @goal %>

<body class="bg-[#FFF5E8] flex flex-col h-screen overflow-auto" data-page="goal-new">
  <div class="flex-grow p-4 flex-col md:flex-row" style="display: flex; flex-direction: column;">  
    <div class="actions mb-4 flex mr-5">
      <% breadcrumb :goal_new %>
      <%= breadcrumbs separator: " › " %>
    </div>
    <main class="flex-grow p-4 flex flex-col items-center justify-center">
      <%= form_with model: @goal, local: true, html: { class: "w-full max-w-md" } do |form| %>
        <div class="mb-4">
          <%= form.label :title, "目標" %>
          <%= form.text_area :title, placeholder: "目標を入力してください", required: true, class: "rounded p-2 w-full", id: "goal-title-input-new" %>
          <div class="text-sm text-gray-500 mt-1">
            <span id="title-char-count-new">0</span>/40
          </div>
        </div>

        <div class="mb-4">
          <%= form.label :due_date, "達成予定日" %>
          <%= form.date_field :due_date, class: "rounded p-2 w-full" %>
        </div>

        <div class="mb-4">
          <%= form.label :status, "達成状況" %>
          <%= form.select :status, Goal.statuses.keys.map { |status| [status.humanize, status] }, { prompt: '選択してください' }, { class: "rounded p-2 w-full" } %>
        </div>

        <div class="mb-9">
          <%= form.label :category, "カテゴリー" %>
          <%= form.select :category, Goal.categories.keys.map { |category| [category.humanize, category] }, { prompt: '選択してください' }, { class: "rounded p-2 w-full" } %>
        </div>

        <div class="flex flex-col justify-center items-center md:items-start mb-5">
          <div class="flex mb-5 justify-between w-full">
            <div class="actions mb-5 flex mr-5">
              <%= link_to "キャンセル", goals_path, class: "bg-gray-300 text-black flex items-center px-4 py-2 rounded shadow button" %>
            </div>
            <div class="actions mb-5 flex">
              <%= form_with model: @goal, url: goals_path, local: true do |form| %>
                <%= form.submit "作成", class: "bg-white text-black flex items-center px-4 py-2 rounded shadow button" %>
              <% end %>
            </div>
          </div>  
        </div>
      <% end %>  
    </main>
  </div>

  <!-- 文字数カウント用のスクリプト -->
  <script>
    const initializeCharCountNew = () => {
      // 作成画面でのみ実行
      if (document.body.dataset.page !== "goal-new") return;

      const titleInput = document.getElementById("goal-title-input-new");
      const charCountDisplay = document.getElementById("title-char-count-new");

      if (!titleInput || !charCountDisplay) return; // 要素が存在しない場合はスキップ

      // 文字数を更新する関数
      const updateCharCount = () => {
        const charCount = titleInput.value.length;
        charCountDisplay.textContent = charCount;
        if (charCount > 40) {
          charCountDisplay.style.color = "red";
        } else {
          charCountDisplay.style.color = "gray";
        }
      };

      // 初期文字数を設定
      updateCharCount();

      // 入力時のリアルタイム更新
      titleInput.addEventListener("input", updateCharCount);
    };

    // Turboのレンダリング後に実行
    document.addEventListener("turbo:render", initializeCharCountNew);
    // 初回ロード時にも実行
    document.addEventListener("DOMContentLoaded", initializeCharCountNew);
  </script>
</body>

<%= render "shared/footer" %>
<!-- Font AwesomeのCDNを読み込む -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

</html>