<!DOCTYPE html>
<html>
<%= csrf_meta_tags %>
<link href="https://fonts.googleapis.com/css2?family=Aldrich&display=swap" rel="stylesheet"> <!-- Aldrichフォントをインポート -->
<style>
  /* app/assets/stylesheets/application.css */
  .tweet .bg-green-200 {
    border-radius: 20px 20px 0 20px;
  }

  .tweet .bg-white {
    border-radius: 20px 20px 20px 0;
  }

  body {
    display: flex;
    flex-direction: column;
    min-height: 100vh; /* 高さを画面いっぱいにする */
  }
  footer {
    margin-top: auto; /* フッターを下に寄せる */
  }
  header h2 {
    font-family: 'Aldrich', sans-serif; /* Aldrichフォントを適用 */
  }
  .link {
    transition: color 0.3s; /* スムーズなトランジション */
  }

  .link:hover {
    color: #E3E3E3; /* ホバー時の文字色 */
  }

  .link:active {
    color: #A9A9A9; /* クリック時の文字色 */
  }

  #send-message {
    background-color: #FFA230; /* オレンジ */
    transition: background-color 0.3s; /* スムーズな変化 */
  }
  #send-message:hover {
    background-color: #E6952A; /* ホバーで暗め */
  }
  #send-message:active {
    background-color: #D98326; /* アクティブでさらに暗め */
  }

  .restricted-input {
    height: 50px; /* inputと高さ揃える */
    resize: none; /* スクロールバー非表示 */
    white-space: normal; /* 折り返し有効 */
    overflow-wrap: break-word; /* 単語折り返し */
    display: flex; /* 中央揃え */
    align-items: center; /* 上下中央 */
    padding: 6px; /* 上下余裕 */
  }
  .restricted-input::placeholder {
    font-size: 0.8rem; /* 小さい文字 */
    color: #999; /* 薄グレーで読みやすく */
    white-space: normal; /* プレースホルダー折り返し */
    overflow-wrap: break-word;
  }
</style>

<header class="fixed top-0 left-0 w-full bg-[#FFC276] text-white p-6 flex justify-between items-center">
  <h2 class="text-4xl"><%= link_to "DreamScope100", dashboard_index_path, class: "text-white link" %></h2>
  <%= link_to "ログアウト", destroy_user_session_path, data: { turbo_method: :delete }, class: "text-white link", onclick: "return confirm('ログアウトしますか？');" %>
</header>
<% if current_user.email_password_unset? %>
  <%= render "shared/flash" %>
<% end %>

<body class="bg-[#FFF5E8] flex flex-col h-screen">
  <div class="fixed top-20 left-0 w-full bg-[#FFF5E8] p-3fixed top-16 left-0 w-full bg-[#FFF5E8] z-10 p-4">  
    <div class="actions flex mr-5">
      <% breadcrumb :openchat %>
      <%= breadcrumbs separator: " &rsaquo; " %>
    </div>
  </div>

  <!-- チャットエリア（スクロール可能） -->
  <div id="tweets" class="flex-grow overflow-y-auto p-4" style="padding-top: 140px; padding-bottom: 160px;">
    <div class="max-w-md mx-auto flex flex-col space-y-2 justify-end min-h-full">
      <% @tweets.each do |tweet| %>
        <%= render partial: "shared/message", locals: { tweet: tweet, is_current_user: (tweet.user == current_user) } %>
      <% end %>
    </div>
  </div>

  <!-- 入力フォーム（固定） -->
  <div class="fixed bottom-14 left-0 w-full bg-[#FFF5E8] z-10 p-4">
    <div class="max-w-md mx-auto flex items-center space-x-2">
      <%= label_tag :message, 'Say something:', class: "sr-only" %>
      <% if current_user.email_password_unset? %>
        <%= text_area_tag :message, nil, placeholder: "※メールアドレス・パスワードを設定するとメッセージを送信できます", class: "flex-grow border rounded p-2 restricted-input", readonly: true, rows: 2 %>
      <% else %>
        <%= text_field_tag :message, nil, data: { behavior: 'room_speaker' }, class: "flex-grow border rounded p-2" %>
      <% end %>
      <% unless current_user.email_password_unset? %>
        <button id="send-message" class="bg-blue-500 text-white px-4 py-2 rounded">送信</button>
      <% end %>
    </div>
  </div>
  <div class="fixed bottom-0 left-0 w-full z-0">
    <footer class="fixed bottom-0 left-0 w-full bg-[#FFC276] text-white p-4 flex justify-between">
      <div>
        <%= link_to 'プライバシーポリシー', privacypolicy_index_path, class: "text-white link" %>
        <%= link_to '利用規約', riyoukiyaku_index_path, class: "text-white link" %>
        <%= link_to 'お問い合わせ', new_public_contact_path, class: "text-white link" %>
      </div>
      <p>© 2025 DreamScope100. All rights reserved.</p>
    </footer>
  </div>
</body>

<!-- Font AwesomeのCDNを読み込む -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  function scrollToBottom() {
    const tweetsContainer = document.getElementById('tweets');
    if (tweetsContainer) {
      tweetsContainer.scrollTop = tweetsContainer.scrollHeight;
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    setTimeout(scrollToBottom, 100);
  });

  document.addEventListener('turbo:load', () => {
    setTimeout(scrollToBottom, 100);
  });

  document.addEventListener('DOMContentLoaded', () => {
    const sendButton = document.getElementById('send-message');
    const inputField = document.querySelector('input[data-behavior="room_speaker"]');

    sendButton?.addEventListener('click', () => {
      setTimeout(scrollToBottom, 100);
    });
  });
</script>
</html>