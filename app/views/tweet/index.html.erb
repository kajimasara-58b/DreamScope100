<!DOCTYPE html>
<html>
<style>
  /* app/assets/stylesheets/application.css */
  .tweet .bg-green-200 {
    border-radius: 20px 20px 0 20px;
  }

  .tweet .bg-white {
    border-radius: 20px 20px 20px 0;
  }
</style>

<%= render "shared/header" %>


<body class="bg-[#FFF5E8] flex flex-col min-h-screen">
  <div class="fixed top-20 left-0 w-full bg-[#FFF5E8] p-3fixed top-16 left-0 w-full bg-[#FFF5E8] z-10 p-4">  
    <div class="actions flex mr-5">
      <% breadcrumb :openchat %>
      <%= breadcrumbs separator: " &rsaquo; " %>
    </div>
  </div>

  <!-- チャットエリア（スクロール可能） -->
  <div id="tweets" class="flex-grow overflow-y-auto p-4" style="padding-top: 140px; padding-bottom: 160px;">
    <div class="max-w-md mx-auto flex flex-col space-y-2 justify-end min-h-full">
      <% @tweets.each do |tweet| %>
        <%= render partial: "shared/message", locals: { tweet: tweet, is_current_user: (tweet.user == current_user) } %>
      <% end %>
    </div>
  </div>

  <!-- 入力フォーム（固定） -->
  <div class="fixed bottom-14 left-0 w-full bg-[#FFF5E8] z-10 p-4">
    <div class="max-w-md mx-auto flex items-center space-x-2">
      <%= label_tag :message, 'Say something:', class: "sr-only" %>
      <%= text_field_tag :message, nil, data: { behavior: 'room_speaker' }, class: "flex-grow border rounded p-2" %>
      <button id="send-message" class="bg-blue-500 text-white px-4 py-2 rounded">送信</button>
    </div>
  </div>
  <div class="fixed bottom-0 left-0 w-full z-0">
    <%= render "shared/footer" %>
  </div>
</body>

<!-- Font AwesomeのCDNを読み込む -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  // ページ読み込み時に一番下にスクロール
  document.addEventListener('DOMContentLoaded', () => {
    const tweetsContainer = document.getElementById('tweets');
    if (tweetsContainer) {
      tweetsContainer.scrollTop = tweetsContainer.scrollHeight;
    }
  });

  // Turbo によるページ遷移後にもスクロール
  document.addEventListener('turbo:load', () => {
    const tweetsContainer = document.getElementById('tweets');
    if (tweetsContainer) {
      tweetsContainer.scrollTop = tweetsContainer.scrollHeight;
    }
  });
</script>
</html>