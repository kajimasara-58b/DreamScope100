<!DOCTYPE html>
<html>
<style>
  .button {
    transition: background-color 0.3s, color 0.3s; /* スムーズなトランジション */
  }

  .button:hover {
    background-color: #f0f0f0; /* ホバー時の背景色 */
    color: #333; /* ホバー時の文字色 */
  }

  .button:active {
    background-color: #e0e0e0; /* クリック時の背景色 */
    color: #111; /* クリック時の文字色 */
  }
  .alert {
    color: red; /* Tailwind red-500 */
  }
</style>

<%= render "shared/header" %>
<% if flash[:alert] %>
  <div class="alert alert-danger">
    <%= flash[:al　ert] %>
  </div>
<% end %>

<body class="bg-[#FFF5E8] flex flex-col h-screen overflow-auto">
  <div class="flex-grow p-4 flex-col md:flex-row" style="display: flex; flex-direction: column;">  
    <div class="actions mb-4 flex mr-5">
      <% breadcrumb :users_edit %>
      <%= breadcrumbs separator: " &rsaquo; " %>
    </div>
    <main class="flex-grow p-4 flex flex-col items-center justify-center">
      <%= form_with model: @user, local: true, data: { turbo: false }, html: { class: "w-full max-w-md" } do |form| %>
        <div class="field mb-4">
          <%= form.label :name, "ユーザー名" %>
          <%= form.text_field :name, required: true, class: "rounded w-full py-2 px-3" %>
        </div>

        <div class="field mb-6">
          <%= form.label :email, "メールアドレス" %>
          <%= form.email_field :email, class: "rounded w-full py-2 px-3", value: @user.email %>
        </div>

        <div class="flex flex-col justify-center items-center md:items-start mb-5">
            <div class="flex mb-5 justify-between w-full">
            <div class="actions mb-5 flex mr-5">
                <%= link_to "キャンセル", users_show_path, class: "bg-gray-300 text-black flex items-center px-4 py-2 rounded shadow button" %>
            </div>
            <div class="actions mb-5 flex">
                <%= form.submit "更新", class: "bg-white text-black flex items-center px-4 py-2 rounded shadow button" %>
            </div>
            </div>
        </div>
      <% end %>

      <script>
      document.addEventListener("turbo:load", () => {
        const emailInput = document.querySelector("#user_email");
        const form = document.querySelector("form");
        if (emailInput) {
          emailInput.addEventListener("blur", async () => {
            const email = emailInput.value;
            if (email) {
              const response = await fetch(`/users/check_email?email=${encodeURIComponent(email)}`, {
                headers: { Accept: "application/json" },
              });
              const data = await response.json();
              if (data.conflict) {
                const confirmLink = confirm(data.message);
                if (confirmLink) {
                  window.location.href = `/users/initiate_link_account?email=${encodeURIComponent(email)}`;
                } else {
                  emailInput.value = "";
                  emailInput.focus();
                }
              }
            }
          });
        }
      });
      </script>
    </main>
  </div>  
</body>

<!-- Font AwesomeのCDNを読み込む -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

<%= render "shared/footer" %>

</html>